<html lang="en">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <title>Wifi Map</title>
    <link rel="manifest" href="../manifest.webmanifest">
    <!-- Leaflet map -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <style type="text/css">
      .disclaimer {
         visibility: hidden !important; 
       }
       body{
        background:snow;
        }
        .card{
            background-color: #ffffff;
            width:400px;
            padding:20px;
            position: absolute;
            top:  50%;
            left: 50%;
            transform: translate(-50%,-50%);
        }
        .result {
            font-size: 4em;
            line-height: 1.3em;
            text-align: center;
        }
        .message{
            text-align: center;
            font-weight: bold;
            color: #221f1f;
            font-size: 4.5vh;
            line-height: 6vh;
            min-height: 6vh;
        }
	</style>
</head>
<body class="bg-light">
    <!-- navbar -->
    <nav class="navbar sticky-top navbar-expand-lg navbar-dark bg-danger ">
        <div class="container">
           <ul class="navbar-nav">
              <li class="nav-item">
                 <h3><a href="../" class="nav-link">UNSRAT</a></h3>
              </li>
           </ul>
        </div>
     </nav>

     <nav class="navbar navbar-expand navbar-dark 
    bg-danger fixed-bottom">
        <ul class="navbar-nav nav-justified w-100">
            <li class="nav-item">
                <a href="../" class="nav-link ">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-house-fill" viewBox="0 0 16 16">
                        <path fill-rule="evenodd" d="m8 3.293 6 6V13.5a1.5 1.5 0 0 1-1.5 1.5h-9A1.5 1.5 0 0 1 2 13.5V9.293l6-6zm5-.793V6l-2-2V2.5a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5z"/>
                        <path fill-rule="evenodd" d="M7.293 1.5a1 1 0 0 1 1.414 0l6.647 6.646a.5.5 0 0 1-.708.708L8 2.207 1.354 8.854a.5.5 0 1 1-.708-.708L7.293 1.5z"/>
                      </svg>
                </a>
            </li>
            <li class="nav-item">
                <a href="map.php" class="nav-link">Map</a>
            </li>
            <li class="nav-item">
                <a href="#" class="nav-link active">SpeedTest</a>
            </li>
        </ul>
    </nav>

     <!-- main content -->
     <div class="card">
        <div class="message" id="progress">
            Internet Speed Meter
        </div>
        <div class="result" id="result">
          ...
        </div>
        <button id="start" class="btn btn-success">Start</button>
    </div>
    


    <script type="text/javascript">

        // if(window.addEventListener){
        //   window.addEventListener('load', InitiateSpeedDetection, false);
        // }else if(window.attachEvent){
        //   window.attachEvent('onload', InitiateSpeedDetection);
        // }

        const element = document.getElementById("start");
        element.addEventListener("click", InitiateSpeedDetection);
      
        var imageAddr = "https://4k-uhd.nl/wp-content/uploads/2018/08/4K-3840x2160-Wallpaper-Uitzicht-5.jpg"; 
        var downloadSize = 5739426; //bytes
      
        function ShowProgressMessage(msg) {
            var oProgress = document.getElementById("progress");
            if (oProgress) {
                oProgress.innerHTML = msg;
            }
        }
      
        function showResultMessage(msg){
          document.getElementById("result").innerHTML = msg;
          document.getElementById("progress").innerHTML = 'Your Internet Speed is';
        }
      
        function InitiateSpeedDetection() {
            ShowProgressMessage("Calculating Speed ...");
            window.setTimeout(MeasureConnectionSpeed, 1);
        };
      
        function MeasureConnectionSpeed() {
            var startTime, endTime;
            var download = new Image();
            download.onload = function () {
                endTime = (new Date()).getTime();
                showResults();
            }
            
            download.onerror = function (err, msg) {
                ShowProgressMessage("Invalid image, or error downloading");
            }
            
            startTime = (new Date()).getTime();
            var cacheBuster = "?nnn=" + startTime;
            download.src = imageAddr + cacheBuster;
            
            function showResults() {
                var duration = (endTime - startTime) / 1000;
                var bitsLoaded = downloadSize * 8;
                var speedBps = (bitsLoaded / duration).toFixed(2);
                var speedKbps = (speedBps / 1024).toFixed(2);
                var speedMbps = (speedKbps / 1024).toFixed(2);
                showResultMessage(speedMbps + " Mbps");
            }
        }
        function logConnectionType() {
        var connectionType = 'not supported';
        var downlinkMax = 'not supported';
      
        if ('connection' in navigator) {
          connectionType = navigator.connection.effectiveType;
      
          if ('downlinkMax' in navigator.connection) {
            downlinkMax = navigator.connection.downlinkMax;
          }
        }
      
        console.log('Current connection type: ' + connectionType +
          ' (downlink max: ' + downlinkMax + ')');
      }
      
      logConnectionType();
      navigator.connection.addEventListener('change', logConnectionType);
      </script>

     
   <script src="/js/app.js"></script>
   <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" 
      integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" 
      crossorigin="anonymous">
   </script>
</body>
</html>